# Horcrux Configuration File
# This is a comprehensive example showing all available options

[server]
# Listen address and port
# Use 0.0.0.0 to listen on all interfaces
# Use 127.0.0.1 to listen only on localhost
listen = "0.0.0.0:8006"

# Data directory for VMs, templates, and backups
data_dir = "/var/lib/horcrux"

# Log level: trace, debug, info, warn, error
log_level = "info"

# Number of worker threads (defaults to number of CPU cores)
# worker_threads = 8

# TLS/SSL configuration (optional)
# tls_enabled = true
# tls_cert = "/etc/horcrux/ssl/cert.pem"
# tls_key = "/etc/horcrux/ssl/key.pem"

[cluster]
# Cluster name - all nodes in cluster must have same name
name = "horcrux-cluster"

# This node's name (defaults to hostname if not specified)
# node_name = "node1"

# Cluster members for multi-node setup
# List all nodes in the cluster including this one
# members = [
#     "node1.example.com:8006",
#     "node2.example.com:8006",
#     "node3.example.com:8006"
# ]

# Corosync configuration
# corosync_enabled = false
# corosync_bindnet_addr = "192.168.1.0"
# corosync_mcastaddr = "239.255.1.1"
# corosync_mcastport = 5405

# Quorum settings
# quorum_expected = 3
# quorum_votes = 1

[storage]
# Default storage pool for new VMs
default_pool = "local"

# Storage pool definitions
[[storage.pools]]
name = "local"
type = "directory"
path = "/var/lib/horcrux/vms"
content = ["images", "iso", "backup"]

# Example: ZFS pool
# [[storage.pools]]
# name = "zfs-pool"
# type = "zfs"
# pool = "rpool/horcrux"
# content = ["images", "backup"]

# Example: Ceph RBD
# [[storage.pools]]
# name = "ceph-rbd"
# type = "ceph"
# monitors = ["mon1.example.com", "mon2.example.com", "mon3.example.com"]
# pool = "vm-pool"
# username = "admin"
# content = ["images"]

# Example: NFS
# [[storage.pools]]
# name = "nfs-backup"
# type = "nfs"
# server = "nas.example.com"
# export = "/export/horcrux"
# content = ["backup", "iso"]

# Example: CIFS/SMB
# [[storage.pools]]
# name = "smb-storage"
# type = "cifs"
# server = "fileserver.example.com"
# share = "vmdata"
# username = "horcrux"
# domain = "EXAMPLE"
# content = ["images", "backup"]

[auth]
# Session timeout in seconds (default: 2 hours)
session_timeout = 7200

# Enable two-factor authentication
# totp_enabled = false

# PAM authentication
# pam_enabled = false
# pam_service = "horcrux"

# LDAP authentication
# ldap_enabled = false
# ldap_server = "ldap://ldap.example.com"
# ldap_base_dn = "dc=example,dc=com"
# ldap_bind_dn = "cn=admin,dc=example,dc=com"
# ldap_user_attr = "uid"

# OpenID Connect (OIDC) authentication
# oidc_enabled = false
# oidc_issuer = "https://auth.example.com"
# oidc_client_id = "horcrux"
# oidc_client_secret = "secret"
# oidc_scopes = ["openid", "profile", "email"]
# oidc_role_claim = "roles"

# API token settings
# api_token_lifetime = 31536000  # 1 year in seconds

[rbac]
# Default permissions for new users
# default_role = "user"

# Custom roles
# [[rbac.roles]]
# name = "vmadmin"
# permissions = [
#     "VM.Allocate",
#     "VM.Config.Disk",
#     "VM.Config.Network",
#     "VM.PowerMgmt",
#     "VM.Console"
# ]

[backup]
# Default retention policy in days
retention_days = 30

# Backup compression algorithm
# Options: none, gzip, zstd, lz4
compression = "zstd"

# Compression level (1-9 for gzip/zstd, 1-12 for lz4)
compression_level = 3

# Maximum concurrent backup jobs
max_concurrent_backups = 2

# Backup storage pool
backup_pool = "local"

# Backup schedule (cron format)
# backup_schedule = "0 2 * * *"  # 2 AM daily

# Backup providers
# [[backup.providers]]
# name = "s3-backup"
# type = "s3"
# endpoint = "s3.amazonaws.com"
# region = "us-east-1"
# bucket = "horcrux-backups"
# access_key = "AKIAIOSFODNN7EXAMPLE"
# secret_key = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"

[monitoring]
# Metrics collection interval in seconds
interval = 10

# History retention in hours
history_retention = 168  # 7 days

# Enable advanced metrics (PSI, NUMA, ZFS ARC)
advanced_metrics = true

# Prometheus exporter
# prometheus_enabled = false
# prometheus_port = 9090

# OpenTelemetry configuration
# otel_enabled = false
# otel_endpoint = "http://localhost:4317"
# otel_service_name = "horcrux"

[alerts]
# Email notification settings
# email_enabled = false
# smtp_server = "smtp.example.com"
# smtp_port = 587
# smtp_username = "alerts@example.com"
# smtp_password = "password"
# smtp_from = "Horcrux Alerts <alerts@example.com>"
# smtp_to = ["admin@example.com"]

# Webhook notifications
# webhook_enabled = false
# webhook_url = "https://hooks.example.com/alerts"

# Slack notifications
# slack_enabled = false
# slack_webhook = "https://hooks.slack.com/services/YOUR/WEBHOOK/URL"

# Alert rules
# [[alerts.rules]]
# name = "high-cpu"
# metric = "cpu_usage"
# operator = ">"
# threshold = 90
# duration = 300  # seconds
# severity = "warning"

# [[alerts.rules]]
# name = "disk-full"
# metric = "disk_usage"
# operator = ">"
# threshold = 95
# severity = "critical"

[network]
# Default bridge for VM network interfaces
default_bridge = "vmbr0"

# Enable Software Defined Networking (SDN)
sdn_enabled = true

# Network bridges
# [[network.bridges]]
# name = "vmbr0"
# address = "192.168.1.1/24"
# ports = ["eth0"]

# [[network.bridges]]
# name = "vmbr1"
# address = "10.0.0.1/24"
# vlan_aware = true

# SDN zones
# [[network.sdn.zones]]
# zone = "public"
# type = "vxlan"
# peers = ["node1", "node2", "node3"]

# [[network.sdn.vnets]]
# vnet = "web"
# zone = "public"
# tag = 100

[ha]
# Enable High Availability
# enabled = false

# HA group configuration
# [[ha.groups]]
# name = "ha-group-1"
# nodes = ["node1", "node2", "node3"]
# restricted = false
# no_failback = false

# HA resources
# [[ha.resources]]
# vm_id = 100
# group = "ha-group-1"
# max_restart = 3
# max_relocate = 3

[migration]
# Enable live migration
# enabled = false

# Migration network (optional, uses cluster network by default)
# network = "10.0.1.0/24"

# Migration bandwidth limit in MB/s (0 = unlimited)
# bandwidth_limit = 100

# Concurrent migrations allowed
# max_concurrent = 1

[console]
# VNC configuration
vnc_enabled = true
vnc_port_range = "5900-5999"

# SPICE configuration (alternative to VNC)
# spice_enabled = false
# spice_port_range = "3128-3227"

# NoVNC web console
# novnc_enabled = true
# novnc_port = 6080

[security]
# Enable firewall
firewall_enabled = true

# Default firewall policy
# firewall_default_policy = "DROP"

# Enable audit logging
# audit_enabled = false
# audit_log = "/var/log/horcrux/audit.log"

# Rate limiting for API
# rate_limit_enabled = true
# rate_limit_requests = 100  # per minute
# rate_limit_burst = 20

[advanced]
# Enable experimental features
# experimental = false

# Custom CPU flags for VMs
# cpu_flags = ["+aes", "+ssse3"]

# Maximum VMs per node
# max_vms = 100

# VM startup delay in seconds
# vm_startup_delay = 2

# Automatic guest agent installation
# auto_guest_agent = true

# Memory overcommit ratio (1.0 = no overcommit, 1.5 = 50% overcommit)
# memory_overcommit = 1.0
